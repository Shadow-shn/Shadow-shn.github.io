<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Realtime Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system;
  background:#0f172a;
  color:white;
}
.chat-box{
  max-width:500px;
  margin:auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.header{
  padding:15px;
  background:#020617;
  text-align:center;
  font-weight:600;
}
.name-area{
  padding:10px;
  background:#020617;
}
.messages{
  flex:1;
  padding:15px;
  overflow-y:auto;
  background:#020617;
}
.msg{
  max-width:75%;
  padding:10px 14px;
  margin-bottom:10px;
  border-radius:14px;
  word-wrap:break-word;
  font-size:.95rem;
}
.me{
  background:#2563eb;
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.other{
  background:#1e293b;
  margin-right:auto;
  border-bottom-left-radius:4px;
}
.name{
  font-size:.75rem;
  opacity:.7;
  margin-bottom:4px;
}
.input-area{
  padding:10px;
  background:#020617;
}
input{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  margin-bottom:8px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#2563eb;
  color:white;
  font-weight:600;
}
</style>
</head>

<body>

<div class="chat-box">
  <div class="header">ðŸ’¬ Public Chat</div>

  <div class="name-area">
    <input id="name" placeholder="Your name">
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <input id="msg" placeholder="Type message">
    <button onclick="send()">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyD6wuDYeftzktN3JiO6HqdxDR316thEzTY",
  authDomain: "shadow-chat-15c3b.firebaseapp.com",
  projectId: "shadow-chat-15c3b",
  storageBucket: "shadow-chat-15c3b.firebasestorage.app",
  messagingSenderId: "284971750396",
  appId: "1:284971750396:web:05bdc595fcdeb933441879"
};

/* INIT */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const col = collection(db,"messages");
const q = query(col, orderBy("time"));

/* NAME SAVE + LOAD */
const nameInput = document.getElementById("name");
nameInput.value = localStorage.getItem("chatName") || "";

nameInput.oninput = () => {
  localStorage.setItem("chatName", nameInput.value);
};

/* LOAD MESSAGES */
onSnapshot(q, snap=>{
  const box=document.getElementById("messages");
  box.innerHTML="";
  const myName = localStorage.getItem("chatName");

  snap.forEach(doc=>{
    const d=doc.data();
    const div=document.createElement("div");
    div.className="msg " + (d.name===myName ? "me":"other");

    const time = new Date(d.time).toLocaleTimeString([],{
      hour:"2-digit", minute:"2-digit"
    });

    div.innerHTML = `
      <div class="name">${d.name} â€¢ ${time}</div>
      ${d.text}
    `;
    box.appendChild(div);
  });

  box.scrollTop = box.scrollHeight;
});

/* SEND MESSAGE */
window.send = async ()=>{
  const name = localStorage.getItem("chatName") || "Guest";
  const text = document.getElementById("msg").value;
  if(!text) return;

  await addDoc(col,{
    name,
    text,
    time: Date.now()
  });

  document.getElementById("msg").value="";
};

/* ENTER TO SEND */
document.getElementById("msg").addEventListener("keypress", e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>
